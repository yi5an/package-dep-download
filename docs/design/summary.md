# ç¦»çº¿è½¯ä»¶åŒ…ä¸‹è½½æœåŠ¡ - è®¾è®¡æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æ„å»ºä¸€ä¸ªå¸¦ Web ç•Œé¢çš„ç¦»çº¿è½¯ä»¶åŒ…ä¸‹è½½æœåŠ¡,ç”¨æˆ·å¯ä»¥è¾“å…¥åŒ…åã€é€‰æ‹©ç³»ç»Ÿå‘è¡Œç‰ˆ,ç³»ç»Ÿè‡ªåŠ¨è§£æä¾èµ–å¹¶ä»é•œåƒç«™ç›´æ¥ä¸‹è½½,æœ€åç”Ÿæˆå‹ç¼©åŒ…ä¾›ç”¨æˆ·ä¸‹è½½ã€‚

### æ ¸å¿ƒéœ€æ±‚

âœ… ä¸ªäºº/å›¢é˜Ÿå†…ç½‘å·¥å…·
âœ… å®æ—¶åé¦ˆ + è‡ªåŠ¨ä¸‹è½½
âœ… åŒ…æœç´¢å»ºè®® + æ‰¹é‡å¯¼å…¥ + é¢„è®¾æ¨¡æ¿ + åŸºç¡€è¾“å…¥
âœ… FastAPI åç«¯ + åŸç”Ÿ JS å‰ç«¯
âœ… ä»»åŠ¡å†å²è®°å½•
âœ… **çº¯ Python å®ç°ä¾èµ–è§£æ,ä¸ä¾èµ–ç³»ç»Ÿå‘½ä»¤**

---

## æŠ€æœ¯æ ˆ

### åç«¯
- **FastAPI 0.100+**: ç°ä»£å¼‚æ­¥ Web æ¡†æ¶
- **Python 3.11+**: ç±»å‹æç¤ºã€æ€§èƒ½ä¼˜åŒ–
- **uvicorn**: ASGI æœåŠ¡å™¨
- **requests**: HTTP å®¢æˆ·ç«¯
- **Pydantic**: æ•°æ®éªŒè¯

### å‰ç«¯
- **åŸç”Ÿ JavaScript ES6+**: æ— æ¡†æ¶ä¾èµ–
- **CSS3**: Flexbox/Grid å“åº”å¼å¸ƒå±€
- **Server-Sent Events**: å®æ—¶è¿›åº¦æ¨é€

### éƒ¨ç½²
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **Docker Compose**: å¤šå®¹å™¨ç¼–æ’
- **Nginx**: åå‘ä»£ç† (ç”Ÿäº§ç¯å¢ƒ)
- **Systemd**: æœåŠ¡ç®¡ç† (ç”Ÿäº§ç¯å¢ƒ)

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æµè§ˆå™¨ç«¯ (å‰ç«¯)                       â”‚
â”‚  å•é¡µåº”ç”¨ - åŸç”Ÿ JavaScript + Server-Sent Events        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• HTTP/SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FastAPI æœåŠ¡å™¨ (åç«¯)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  REST API    â”‚  â”‚   SSE ç«¯ç‚¹   â”‚  â”‚  ä»»åŠ¡ç®¡ç†å™¨   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         åŒ…ä¸‹è½½å¼•æ“ (çº¯ Python å®ç°)                â”‚  â”‚
â”‚  â”‚  - RPM repodata è§£æå™¨                            â”‚  â”‚
â”‚  â”‚  - DEB Packages.gz è§£æå™¨                         â”‚  â”‚
â”‚  â”‚  - å¤šçº¿ç¨‹ HTTP ä¸‹è½½å™¨                              â”‚  â”‚
â”‚  â”‚  - é•œåƒç«™æ•…éšœåˆ‡æ¢                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ–‡ä»¶ç³»ç»Ÿ                             â”‚
â”‚  downloads/  +  logs/  +  SQLite (ä»»åŠ¡å†å²)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ä¾èµ–è§£æå¼•æ“

**RPM ç³»ç»Ÿ**:
- ä¸‹è½½å¹¶è§£æ `repodata/repomd.xml`
- è§£æ `primary.xml.gz` è·å–åŒ…å…ƒæ•°æ®
- æå–ä¾èµ–å…³ç³» (Requires å­—æ®µ)
- é€’å½’è§£ææ‰€æœ‰ä¾èµ–
- æ”¯æŒ CentOS/RHEL/Fedora

**DEB ç³»ç»Ÿ**:
- ä¸‹è½½å¹¶è§£å‹ `Packages.gz`
- è§£æåŒ…ä¿¡æ¯ (çº¯æ–‡æœ¬æ ¼å¼)
- æå– Depends å­—æ®µ
- è§£æç‰ˆæœ¬é™åˆ¶ (`>=`, `=` ç­‰)
- æ”¯æŒ Debian/Ubuntu

### 2. HTTP ä¸‹è½½å™¨

- å¤šçº¿ç¨‹ä¸‹è½½ (é»˜è®¤ 5 ä¸ªå¹¶å‘)
- æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- è¿›åº¦å›è°ƒæœºåˆ¶
- é•œåƒç«™è‡ªåŠ¨æ•…éšœåˆ‡æ¢
- æ”¯æŒè·¨æ¶æ„ä¸‹è½½ (åœ¨ x86_64 ä¸Šä¸º aarch64 ä¸‹è½½)

### 3. ä»»åŠ¡ç®¡ç†å™¨

- åå°ä»»åŠ¡é˜Ÿåˆ—
- å¹¶å‘é™åˆ¶ (æœ€å¤š 3 ä¸ªåŒæ—¶ä¸‹è½½)
- ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª (pending â†’ running â†’ completed/failed)
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶ (24 å°æ—¶)

### 4. Web ç•Œé¢

**ä¸»ç•Œé¢**:
- åŒ…è¾“å…¥ç»„ä»¶ (æ ‡ç­¾å¼)
- åŒ…æœç´¢ç»„ä»¶ (å®æ—¶å»ºè®®)
- ç³»ç»Ÿé€‰æ‹© (RPM/DEB, å‘è¡Œç‰ˆ, æ¶æ„)
- è¿›åº¦æ˜¾ç¤º (è¿›åº¦æ¡ + å®æ—¶æ—¥å¿—)
- ä»»åŠ¡å†å²åˆ—è¡¨

**ç‰¹æ€§**:
- å“åº”å¼è®¾è®¡ (æ¡Œé¢ + ç§»åŠ¨ç«¯)
- å®æ—¶è¿›åº¦æ¨é€ (SSE)
- è‡ªåŠ¨è§¦å‘ä¸‹è½½ (å®Œæˆå)
- æ‰¹é‡å¯¼å…¥æ”¯æŒ
- é¢„è®¾æ¨¡æ¿ (Web æœåŠ¡å™¨ã€Dockerã€å¼€å‘å·¥å…·)

---

## API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/` | GET | è¿”å›å‰ç«¯é¡µé¢ |
| `/api/download` | POST | åˆ›å»ºä¸‹è½½ä»»åŠ¡ |
| `/api/tasks` | GET | åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡ |
| `/api/tasks/{id}` | GET | è·å–ä»»åŠ¡çŠ¶æ€ |
| `/api/download/{id}` | GET | ä¸‹è½½ç”Ÿæˆçš„å‹ç¼©åŒ… |
| `/api/tasks/{id}` | DELETE | åˆ é™¤ä»»åŠ¡ |
| `/api/packages` | GET | æœç´¢è½¯ä»¶åŒ… |
| `/api/systems` | GET | è·å–æ”¯æŒçš„ç³»ç»Ÿ |
| `/api/events/{id}` | GET | SSE å®æ—¶è¿›åº¦ |
| `/api/health` | GET | å¥åº·æ£€æŸ¥ |

---

## æ•°æ®æµ

### ä¸‹è½½æµç¨‹

```
ç”¨æˆ·è¾“å…¥åŒ…å
    â†“
å‰ç«¯éªŒè¯ â†’ POST /api/download
    â†“
åç«¯åˆ›å»ºä»»åŠ¡,è¿”å› task_id
    â†“
åå°çº¿ç¨‹å¯åŠ¨:
    1. è§£æä¾èµ– (é€’å½’)
    2. ç”Ÿæˆä¸‹è½½åˆ—è¡¨
    3. å¤šçº¿ç¨‹ä¸‹è½½åŒ…
    4. æ‰“åŒ…æˆ tar.gz
    â†“
SSE å®æ—¶æ¨é€è¿›åº¦
    â†“
å‰ç«¯æ›´æ–° UI
    â†“
å®Œæˆåè‡ªåŠ¨ä¸‹è½½
```

### å®æ—¶é€šä¿¡

```
å‰ç«¯ â†’ POST /api/download â†’ åç«¯åˆ›å»ºä»»åŠ¡
å‰ç«¯ â† task_id â† åç«¯

å‰ç«¯ â†’ GET /api/events/{task_id} â†’ å»ºç«‹ SSE è¿æ¥

åç«¯ â†’ event: progress â†’ å‰ç«¯æ›´æ–°è¿›åº¦æ¡
åç«¯ â†’ event: package_downloaded â†’ å‰ç«¯æ›´æ–°æ—¥å¿—
åç«¯ â†’ event: completed â†’ å‰ç«¯è§¦å‘ä¸‹è½½

å‰ç«¯ â†’ GET /api/download/{task_id} â†’ åç«¯è¿”å› tar.gz
```

---

## æ–‡ä»¶ç»“æ„

```
package-dependence-download/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                 # FastAPI åº”ç”¨ä¸»å…¥å£
â”‚   â”œâ”€â”€ models.py              # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ resolvers/             # ä¾èµ–è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ rpm.py            # RPM ä¾èµ–è§£æ
â”‚   â”‚   â””â”€â”€ deb.py            # DEB ä¾èµ–è§£æ
â”‚   â”œâ”€â”€ downloaders/           # ä¸‹è½½å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ http.py           # HTTP ä¸‹è½½å™¨
â”‚   â”‚   â””â”€â”€ mirror.py         # é•œåƒç«™ç®¡ç†
â”‚   â”œâ”€â”€ task_manager.py       # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â””â”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html            # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css         # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js            # ä¸»åº”ç”¨é€»è¾‘
â”‚       â”œâ”€â”€ api.js            # API å°è£…
â”‚       â”œâ”€â”€ components/       # UI ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ PackageInput.js
â”‚       â”‚   â”œâ”€â”€ Progress.js
â”‚       â”‚   â””â”€â”€ TaskList.js
â”‚       â””â”€â”€ utils.js          # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                 # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/          # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ e2e/                  # E2E æµ‹è¯•
â”‚   â””â”€â”€ fixtures.py           # æµ‹è¯•æ•°æ®
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ design/               # è®¾è®¡æ–‡æ¡£
â”‚       â”œâ”€â”€ architecture-overview.md
â”‚       â”œâ”€â”€ dependency-resolution.md
â”‚       â”œâ”€â”€ frontend-design.md
â”‚       â”œâ”€â”€ api-design.md
â”‚       â”œâ”€â”€ deployment.md
â”‚       â””â”€â”€ testing.md
â”‚
â”œâ”€â”€ downloads/                # ä¸‹è½½æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/                     # æ—¥å¿—ç›®å½•
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---

## å…³é”®ç‰¹æ€§

### âœ… ä¸ä¾èµ–ç³»ç»Ÿå‘½ä»¤
- çº¯ Python è§£æ repodata/Packages.gz
- ç›´æ¥ä»é•œåƒç«™ HTTP ä¸‹è½½
- å®¹å™¨å‹å¥½,è·¨å¹³å°

### âœ… å®æ—¶è¿›åº¦åé¦ˆ
- Server-Sent Events æ¨é€
- è¿›åº¦æ¡ + å®æ—¶æ—¥å¿—
- å®Œæˆåè‡ªåŠ¨ä¸‹è½½

### âœ… æ™ºèƒ½ä¾èµ–è§£æ
- é€’å½’è§£ææ‰€æœ‰ä¾èµ–
- æ”¯æŒç‰ˆæœ¬é™åˆ¶
- å¤„ç†å¾ªç¯ä¾èµ–

### âœ… é«˜å¯ç”¨æ€§
- é•œåƒç«™è‡ªåŠ¨æ•…éšœåˆ‡æ¢
- æ–­ç‚¹ç»­ä¼ 
- å¤šçº¿ç¨‹ä¸‹è½½

### âœ… æ˜“äºéƒ¨ç½²
- Docker ä¸€é”®éƒ¨ç½²
- å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£
- å¥åº·æ£€æŸ¥ç«¯ç‚¹

---

## æ€§èƒ½æŒ‡æ ‡

- å¹¶å‘ä¸‹è½½: æœ€å¤š 3 ä¸ªåŒæ—¶è¿›è¡Œ
- ä¸‹è½½çº¿ç¨‹: æ¯ä»»åŠ¡ 5 ä¸ªå¹¶å‘çº¿ç¨‹
- å“åº”æ—¶é—´: < 100ms (API è¯·æ±‚)
- å†…å­˜ä½¿ç”¨: < 200MB (ç©ºé—²)
- æ”¯æŒåŒ…æ•°: å•æ¬¡æœ€å¤š 100 ä¸ª

---

## å®‰å…¨è€ƒè™‘

- è¾“å…¥éªŒè¯ (Pydantic)
- åŒ…åæ ¼å¼æ£€æŸ¥
- æ–‡ä»¶å¤§å°é™åˆ¶ (1GB)
- é™æµä¿æŠ¤ (10 è¯·æ±‚/åˆ†é’Ÿ)
- å¯é€‰ API Token è®¤è¯

---

## ä¸‹ä¸€æ­¥:å®æ–½

### å®æ–½é¡ºåº

1. **Phase 1: æ ¸å¿ƒåŠŸèƒ½** (2-3 å¤©)
   - ä¾èµ–è§£æå™¨ (RPM + DEB)
   - HTTP ä¸‹è½½å™¨
   - åŸºç¡€ API ç«¯ç‚¹

2. **Phase 2: Web ç•Œé¢** (1-2 å¤©)
   - å‰ç«¯é¡µé¢
   - SSE é›†æˆ
   - äº¤äº’é€»è¾‘

3. **Phase 3: å¢å¼ºåŠŸèƒ½** (1-2 å¤©)
   - åŒ…æœç´¢
   - æ‰¹é‡å¯¼å…¥
   - é¢„è®¾æ¨¡æ¿

4. **Phase 4: æµ‹è¯•ä¸ä¼˜åŒ–** (1 å¤©)
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–

5. **Phase 5: éƒ¨ç½²** (1 å¤©)
   - Docker é•œåƒ
   - éƒ¨ç½²æ–‡æ¡£
   - ç›‘æ§é…ç½®

**æ€»è®¡**: çº¦ 6-9 å¤©å®Œæˆ

---

## æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤çš„ç¦»çº¿è½¯ä»¶åŒ…ä¸‹è½½æœåŠ¡ã€‚è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™:

1. **ç®€å•ä¼˜äºå¤æ‚**: åŸç”Ÿ JS å‰ç«¯,æ— æ¡†æ¶ä¾èµ–
2. **å¯é æ€§ä¼˜å…ˆ**: å¤šé•œåƒç«™ã€æ–­ç‚¹ç»­ä¼ ã€é”™è¯¯å¤„ç†
3. **ç”¨æˆ·ä½“éªŒ**: å®æ—¶åé¦ˆã€è‡ªåŠ¨ä¸‹è½½ã€æ¸…æ™°æ—¥å¿—
4. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ã€å®Œæ•´æµ‹è¯•ã€è¯¦ç»†æ–‡æ¡£

å‡†å¤‡å¥½å¼€å§‹å®ç°äº†å—? ğŸš€
